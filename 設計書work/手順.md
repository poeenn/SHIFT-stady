# NW設定
hostnameの設定
```
hostname bear1
hostname bear2
hostname bear3
hostname bear4
hostname bear5
```

hostsを全ノードに設定
```
cat << EOF >> /etc/hosts 2>&1
L3SW 192.168.200.254
bear1 192.168.20.1
bear2 192.168.20.2
bear3 192.168.20.3
bear4 192.168.20.4
bear5 192.168.20.5
k8s-master1 172.16.30.1
k8s-node1 172.16.30.2
k8s-node2 172.16.30.3
EOF
```

ifconfigの設定
```
nmcli c modify eth1 ipv4.addresses "192.168.20.1"/24 
nmcli c modify eth1 ipv4.addresses "192.168.20.2"/24 
nmcli c modify eth1 ipv4.addresses "192.168.20.3"/24 
nmcli c modify eth1 ipv4.addresses "192.168.20.4"/24 
nmcli c modify eth1 ipv4.addresses "192.168.20.5"/24 


nmcli c down eth1
nmcli c up eth1
```

ルーティング設定の確認
```
route
```

設定されていなければrouteの設定（多分必要ない）
```
route add xxx
```


# ユーザ作成＋sudo
gitのユーザアカウント名でユーザ作成  
オプションでパスワードも設定してしまう。パスワードは全部同じ（設定値は別のテキスト参照）
```
useradd xxx -p password
```

次回ログイン時にパスワード変更させる設定
```
passwd -e xxx
```
 
visudoで/etc/sudoersを開き、下記の行のコメントアウトを外す。
```
 visudo
## Allows people in group wheel to run all commands
%wheel  ALL=(ALL)       ALL
```

sudoさせるユーザをwheelグループに追加
```
 usermod -aG wheel xxx
```

入れるか要検討
> wheelグループのユーザーはすべてsu -でrootになれるようにする  
> /etc/pam.d/su  
> -#auth            required        pam_wheel.so use_uid  
> +auth            required        pam_wheel.so use_uid  
> ユーザ作成  
>   



# pyenvとか
パッケージのインストール
```
yum install -y gcc zlib-devel bzip2 bzip2-devel readline readline-devel sqlite sqlite-devel git pip
```

pyenvリポジトリのクローン
```
git clone https://github.com/pyenv/pyenv.git ~/.pyenv
```

bashrcにpyenvのパスを追加　rootとansibleユーザで実行  
なお bash_profile だとSSHでログインしたときに**読み込まれない**ので bashrc にする
```
echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(pyenv init -)"' >> ~/.bashrc
source ~/.bashrc
```

ansibleユーザにも入れておく
```
echo 'export PATH="$HOME/.pyenv/bin:$PATH"' >> /home/ansible/.bashrc
echo 'eval "$(pyenv init -)"' >> /home/ansible/.bashrc
```

バージョン確認
```
pyenv --version
python --version
```

2.Xのバージョンで最新バージョンを確認する
```
pyenv install --list
```

確認したバージョンをインストールする
```
pyenv install 2.x.x
pyenv virtualenv --distribute 2.x.x ansible
```

pipでパッケージのインストール
```
cat << EOF >> requirements.txt 2>&1
ansible
Jinja2
MarkupSafe
PyYAML
ecdsa
httplib2
paramiko
pycrypto
EOF

pip install -r requirements.txt
```

ansible コマンドを有効化
```
pyenv rehash
```


# SSH設定
鍵を作成する
```
ssh-keygen -t rsa
```

ansibleユーザの設定
```
mkdir -p home/ansible/.ssh/  
chmod 700 home/ansible/.ssh  
chmod 600 home/ansible/.ssh/authorized_keys  
echo id_rsa.pub >> .ssh/authorized_keys  
```

> sudo権限を与えるなら  
> visudo  
> testuser ALL=(ALL) NOPASSWD:ALL  

sshd_configの設定変更
```
vi /etc/ssh/sshd_config

# rootログイン禁止
PermitRootLogin no

# パスワードログイン禁止(要検討)
# PasswordAuthentication no

# ユーザ毎のアクセス制限を有効にする
account required pam_access.so

```
sshサーバーをリスタート
```
/etc/rc.d/init.d/sshd restart
```

~/.ssh/configに書いとくかは要検討  
ansible.cfgで設定するのであればユーザ毎のプロファイルではなく、別のファイルを指定することが可能  
（だが、ansible以外でSSHログインする必要があるのであれば設定する必要がある）
```
vi ~/.ssh/config

Host xxxIPとか
User xxx
HostName xxx
IdentityFile ~/.ssh/id_rsa
```

誰でもログインできる共有ユーザを作る気はない（個人ユーザの意味がなくなってしまう）のでansibleユーザをSSHでログインできないように設定する
```
echo '- : ansible : ALL' >> /etc/security/access.conf 
```




